<script>
    const urlParams = new URLSearchParams(window.location.search);
    const verificationToken = urlParams.get('token');

    document.addEventListener('DOMContentLoaded', function() {
        verifyEmail();
    });

    async function verifyEmail() {
        const statusContainer = document.getElementById('verificationStatus');

        if (!verificationToken) {
            showMessage('ðŸ“§ Account created successfully! Please check your email inbox and click the verification link to activate your account.', 'info');
            statusContainer.innerHTML = `
                <div class="verification-instructions">
                    <h3>What to do next:</h3>
                    <ol>
                        <li><strong>Check your email inbox</strong> for a message from support@veritaslogic.ai.</li>
                        <li><strong>Click the verification link</strong> in the email.</li>
                        <li><strong>Log in</strong> to your new account.</li>
                    </ol>
                    <div class="verification-actions">
                        <a href="login.html" class="form-submit">Go to Login</a>
                    </div>
                </div>
            `;
            return;
        }

        try {
            const apiUrl = '/api/verify-email';
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: verificationToken })
            });

            const result = await response.json();
            statusContainer.style.display = 'none';

            if (response.ok) {
                showMessage('âœ… Email verified successfully! Redirecting you to the login page...', 'success');
                setTimeout(() => { window.location.href = 'login.html'; }, 3000);
            } else {
                showMessage(result.error || 'Email verification failed. Please try again.', 'error');
            }
        } catch (error) {
            console.error('Email verification error:', error);
            statusContainer.style.display = 'none';
            showMessage('Network error. Please check your connection and try again.', 'error');
        }
    }

    function showMessage(message, type) {
        const container = document.getElementById('messageContainer');
        const messageDiv = document.createElement('div');
        messageDiv.className = `${type}-message`;
        messageDiv.textContent = message;

        container.innerHTML = '';
        container.appendChild(messageDiv);
        container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
</script>