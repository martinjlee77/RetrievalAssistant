INFO:__main__:Created new user session: 03924338...
INFO:shared.api_cost_tracker:API cost tracker reset
INFO:shared.analysis_manager:ANALYSIS_EVENT: {"event_type": "start", "timestamp": "2025-10-14T03:25:20.813343", "analysis_id": "e1c37e20", "asc_standard": "ASC 842", "total_words": 586, "file_count": 1, "tier": "3K (\u226410 pages)", "cost": 195.0, "user_id": 7, "status": "running", "success": null, "duration": null, "error": null}
INFO:shared.analysis_manager:Started analysis e1c37e20: ASC 842 - 586 words
INFO:asc842.step_analyzer:ü§ñ Using GPT-5 for main analysis, GPT-5-mini for light tasks
INFO:chromadb.telemetry.product.posthog:Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
INFO:shared.knowledge_base:ChromaDB client initialized for asc842_knowledge_base
INFO:shared.knowledge_base:Embedding function initialized successfully
INFO:shared.knowledge_base:Collection 'asc842_leases' loaded successfully
INFO:asc842.knowledge_search:ASC 842 knowledge search initialized successfully
INFO:asc842.step_analyzer:üè¢ Extracting lessee/tenant name from lease agreement...
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/responses "HTTP/1.1 200 OK"
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5-mini, using default: 'Could not automatically map gpt-5-mini to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5-mini, using default: 'Could not automatically map gpt-5-mini to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
INFO:shared.api_cost_tracker:API Cost - Model: gpt-5-mini, Input tokens: 953, Output tokens: 8, Cost: $0.0010
INFO:shared.api_cost_tracker:Tracked entity_extraction request: $0.0010 (Total: $0.0010)
INFO:asc842.step_analyzer:‚úì Lessee/tenant identified: InnovateTech Solutions, Inc.
INFO:__main__:LLM extracted entity name: InnovateTech Solutions, Inc.
INFO:shared.knowledge_base:üîç Querying asc842_leases knowledge base...
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:shared.knowledge_base:‚úì Retrieved 8 chunks from ChromaDB (0.64s)
INFO:asc842.knowledge_search:Retrieved guidance for Step 1
INFO:asc842.step_analyzer:DEBUG: Making API call to gpt-5 for Step 1
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
INFO:shared.api_cost_tracker:API Cost - Model: gpt-5, Input tokens: 2979, Output tokens: 1684, Cost: $0.0803
INFO:shared.api_cost_tracker:Tracked step_1_analysis request: $0.0803 (Total: $0.0813)
INFO:asc842.step_analyzer:DEBUG: Clean markdown for Step 1 (length: 7365) sample: ### Step 1: Scope, identify a lease, and determine the enforceable period and lease term
**Analysis...
INFO:__main__:DEBUG: Completed step 1
INFO:shared.knowledge_base:üîç Querying asc842_leases knowledge base...
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:shared.knowledge_base:‚úì Retrieved 8 chunks from ChromaDB (0.12s)
INFO:asc842.knowledge_search:Retrieved guidance for Step 2
INFO:asc842.step_analyzer:DEBUG: Making API call to gpt-5 for Step 2
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
INFO:shared.api_cost_tracker:API Cost - Model: gpt-5, Input tokens: 2670, Output tokens: 1514, Cost: $0.0721
INFO:shared.api_cost_tracker:Tracked step_2_analysis request: $0.0721 (Total: $0.1534)
INFO:asc842.step_analyzer:DEBUG: Clean markdown for Step 2 (length: 6471) sample: ### Step 2: Identify components and determine lease payments
**Analysis:**  
- Lease vs. nonlease c...
INFO:__main__:DEBUG: Completed step 2
INFO:shared.knowledge_base:üîç Querying asc842_leases knowledge base...
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:shared.knowledge_base:‚úì Retrieved 8 chunks from ChromaDB (0.32s)
INFO:asc842.knowledge_search:Retrieved guidance for Step 3
INFO:asc842.step_analyzer:üí∞ Extracting lease payment schedule and performing NPV calculations...
INFO:asc842.step_analyzer:DEBUG: Making API call to gpt-5 for Step 3
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
INFO:shared.api_cost_tracker:API Cost - Model: gpt-5, Input tokens: 2838, Output tokens: 1761, Cost: $0.0812
INFO:shared.api_cost_tracker:Tracked step_3_analysis request: $0.0812 (Total: $0.2346)
INFO:asc842.step_analyzer:DEBUG: Clean markdown for Step 3 (length: 7797) sample: ### Step 3: Classify the lease and measure at commencement
Analysis:
From the lessee perspective (I...
INFO:__main__:DEBUG: Completed step 3
INFO:shared.knowledge_base:üîç Querying asc842_leases knowledge base...
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
INFO:shared.knowledge_base:‚úì Retrieved 8 chunks from ChromaDB (0.20s)
INFO:asc842.knowledge_search:Retrieved guidance for Step 4
INFO:asc842.step_analyzer:DEBUG: Making API call to gpt-5 for Step 4
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
WARNING:shared.api_cost_tracker:Failed to get encoding for model gpt-5, using default: 'Could not automatically map gpt-5 to a tokeniser. Please use `tiktok.get_encoding` to explicitly get the tokeniser you expect.'
INFO:shared.api_cost_tracker:API Cost - Model: gpt-5, Input tokens: 2575, Output tokens: 0, Cost: $0.0258
INFO:shared.api_cost_tracker:Tracked step_4_analysis request: $0.0258 (Total: $0.2604)
ERROR:asc842.step_analyzer:ERROR: GPT-5 returned empty/None content for Step 4
ERROR:__main__:ASC 842 analysis error for session 03924338...: GPT-5 returned empty/None content for Step 4
INFO:shared.analysis_manager:üíæ Saving analysis record: e1c37e20
INFO:shared.analysis_manager:Current auth token is valid
INFO:shared.analysis_manager:‚úì Analysis saved to database: e1c37e20
INFO:shared.analysis_manager:ANALYSIS_EVENT: {"event_type": "complete", "timestamp": "2025-10-14T03:31:21.725574", "analysis_id": "e1c37e20", "asc_standard": "ASC 842", "total_words": 586, "file_count": 1, "tier": "3K (\u226410 pages)", "cost": 195.0, "user_id": 7, "status": "failed", "success": false, "duration": 360.6242082118988, "error": "GPT-5 returned empty/None content for Step 4"}
INFO:shared.analysis_manager:Completed analysis e1c37e20: failed - 360.6s